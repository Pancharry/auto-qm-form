# 手動釋出文件套組

本文件含兩部分：
1. RELEASE_CHECKLIST.md（釋出前檢查清單）
2. VERSION_BUMP_CHEATSHEET.md（版本號判斷與指令速查）

你可以直接把下方兩段複製成各自檔案。

---

## 1. RELEASE_CHECKLIST.md

```markdown
# Release Checklist

目的：降低遺漏，確保每一次 tagged release 一致、可追溯。

## A. 判斷這次是否要釋出
- [ ] 有實際功能 / 修補 / 破壞性變更需要被標記
- [ ] main 分支目前是綠（CI 通過 / 沒未完成的爆炸性問題）
- [ ] 沒有尚未合併但應該包含在本次版本的 PR

## B. 確認版本級別 (SemVer)
| 類型 | 版本段 | 說明 | 範例 |
|------|--------|------|------|
| BREAKING (破壞性) | MAJOR (X.0.0) | API/行為不相容 | 移除欄位、改函式簽名 |
| feat (新增功能) | MINOR (x.Y.0) | 相容地增加功能 | 新增 API / 新增指令 |
| fix (修補) | PATCH (x.y.Z) | 相容問題修正 | 修錯字 / Bug 修正 |
| chore / docs / refactor (無功能/修補) | 不 bump | 可與下一次一起發 | 重構 / 文件 |

- [ ] 已判定本次應 bump 的級別： ( ) MAJOR  ( ) MINOR  ( ) PATCH

## C. 決定新版本號
- [ ] 讀取目前 pyproject.toml 內 version
- [ ] 依上步級別計算 新版號 = ________
- [ ] 確認尚未存在同名 tag（git tag | grep v新版號）

## D. 實際修改
- [ ] 修改 pyproject.toml 中 version = "新版號"
- [ ] 更新/新增 CHANGELOG.md 頂部區塊：
  ```
  ## v新版號 - YYYY-MM-DD
  ### Added
  - feat: ...
  ### Fixed
  - fix: ...
  ### Changed
  - refactor: ...
  ```
- [ ]（可選）確認 README: 是否需同步更新版本 / 範例
- [ ] （可選）若有產生碼生成文件或 schema，已重新生成

## E. Commit & Tag
- [ ] git add pyproject.toml CHANGELOG.md
- [ ] git commit -m "chore(release): v新版號"
- [ ] git push origin main
- [ ] git tag v新版號
- [ ] git push origin v新版號

## F. GitHub Release（可選但建議）
- [ ] 開啟 repo Releases → Draft new release
- [ ] Tag: v新版號（若存在可選擇）
- [ ] Title: v新版號
- [ ] Body: 貼上 CHANGELOG 對應段落
- [ ] Publish

## G. 釋出後驗證
- [ ] git fetch --tags 確認 tag 存在
- [ ] 在本地或 CI 中：確認版本讀取正確
  ```
  grep '^version' pyproject.toml
  ```
- [ ] （若日後上 PyPI）pip 安裝測試（目前略）

## H. 回滾策略（出錯才做）
- Tag 錯：刪除本地與遠端
  ```
  git tag -d v錯誤版
  git push origin :refs/tags/v錯誤版
  ```
- pyproject.toml 版本錯：修正版本 -> 新 commit -> 新 tag（必要時跳過錯誤版號，例如直接到下一個 patch）

## I. 下次釋出前可清理
- [ ] 清掉不再需要的暫存分支
- [ ] 建立下一個里程碑 (Milestone) / Issues 分類
```

---

## 2. VERSION_BUMP_CHEATSHEET.md

```markdown
# Version Bump Cheat Sheet

目的：快速判斷與執行版本號更新。採用 SemVer：MAJOR.MINOR.PATCH

## 1. 判斷規則摘要
- MAJOR：不相容變更（刪除 / 修改公共 API 行為、資料結構變更）
- MINOR：向後相容的新功能（新增函式 / 參數可選 / 新模組）
- PATCH：錯誤修正、微調、內部實作優化（不影響 API 契約）
- 不發版：純文件 / 格式 / 重構沒有功能變更

提醒：0.y.z 階段（未達 1.0.0）視專案策略可較彈性；可選：
- 做法 A（嚴格）：仍維持 SemVer 規則
- 做法 B（寬鬆）：破壞性變更只 bump MINOR，直至 1.0.0 前不出 MAJOR
建議：採「嚴格」，利於後續平滑升級到 1.0.0。

## 2. 讀取目前版本
```
grep '^version' pyproject.toml
# 例：version = "0.3.4"
```

## 3. 手動計算新版本（假設 current=0.3.4）
- MAJOR → 1.0.0（若仍在 0.x，評估策略）
- MINOR → 0.4.0
- PATCH → 0.3.5

## 4. 快速計算指令（bash one-liners）

取得目前版本字串：
```
CURR=$(grep '^version *= *"' pyproject.toml | sed -E 's/.*"([^"]+)".*/\1/')
echo $CURR
```

分拆：
```
MAJOR=$(echo $CURR | cut -d. -f1)
MINOR=$(echo $CURR | cut -d. -f2)
PATCH=$(echo $CURR | cut -d. -f3 | sed 's/[^0-9].*//')
```

計算：
```
# PATCH
NEW_PATCH=$MAJOR.$MINOR.$((PATCH+1))
# MINOR
NEW_MINOR=$MAJOR.$((MINOR+1)).0
# MAJOR
NEW_MAJOR=$((MAJOR+1)).0.0
```

替換 pyproject.toml 中版本：
```
# 例：升 PATCH
NEW_VER=$NEW_PATCH
sed -i.bak -E "s/^version *= *\"[^\"]+\"/version = \"$NEW_VER\"/" pyproject.toml
rm pyproject.toml.bak
```

一個函式化（放到 scripts/bump.sh）：
```
#!/usr/bin/env bash
set -e
PART=$1  # major | minor | patch
FILE=pyproject.toml
CURR=$(grep '^version *= *"' $FILE | sed -E 's/.*"([^"]+)".*/\1/')
IFS=. read -r MAJOR MINOR PATCH <<<"$CURR"

case "$PART" in
  major) MAJOR=$((MAJOR+1)); MINOR=0; PATCH=0 ;;
  minor) MINOR=$((MINOR+1)); PATCH=0 ;;
  patch) PATCH=$((PATCH+1)) ;;
  *) echo "Usage: $0 {major|minor|patch}"; exit 1 ;;
esac

NEW_VER="$MAJOR.$MINOR.$PATCH"
sed -i.bak -E "s/^version *= *\"[^\"]+\"/version = \"$NEW_VER\"/" $FILE
rm $FILE.bak
echo "Bumped: $CURR -> $NEW_VER"
```

使用：
```
chmod +x scripts/bump.sh
./scripts/bump.sh minor
```

## 5. 建立釋出 commit 與 tag
（確保已更新 CHANGELOG）

```
git add pyproject.toml CHANGELOG.md
git commit -m "chore(release): v<新版號>"
git push origin main
git tag v<新版號>
git push origin v<新版號>
```

## 6. 常見疏漏提示
| 問題 | 徵兆 | 解法 |
|------|------|------|
| 忘了更新 CHANGELOG | Release 沒說明 | 立即補寫並出 patch (x.y.(z+1)) |
| Tag 與版本不一致 | pip/使用者顯示舊號 | 重新打正確 tag 或 bump next patch |
| 選錯級別 | 使用者期望不符 | 發布一個修正公告 & 視需要 bump 再下一版 |

## 7. Commit 訊息建議格式
- feat: 新增 XXX
- fix: 修正 YYY
- refactor: 重構 ZZZ（無行為改變）
- chore(release): v0.4.0（只用於版本標記）
- docs: 更新 README

## 8. 最小操作流程（10 秒版）
1. 判斷 bump 類型
2. ./scripts/bump.sh patch|minor|major
3. 編輯 CHANGELOG.md
4. commit + tag + push

## 9. 下次升級到自動化前你要準備的
- 保持 commit 前綴一致（feat/fix/...）
- CHANGELOG 結構穩定（工具才容易接手）
- 避免多來源版本（只放 pyproject.toml）

```

---

## 3. 小提醒
- 兩個檔案放進 repo 根目錄即可。
- 若將 bump.sh 納入 pre-commit / Makefile，可再進一步精簡日常操作。
- 未來若導入自動化，可直接刪除或把這些文件標記為 Legacy。

若還需要我幫你生成 scripts/bump.sh 實際檔案或 Makefile，再告訴我。